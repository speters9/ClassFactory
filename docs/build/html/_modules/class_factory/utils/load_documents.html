<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>class_factory.utils.load_documents &#8212; ClassFactory 0.1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=2bf1fcf8" />
    
    <script src="../../../_static/documentation_options.js?v=a58bc63e"></script>
    <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">ClassFactory 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">class_factory.utils.load_documents</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for class_factory.utils.load_documents</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Document Loading and Processing Module</span>
<span class="sd">-------------------------------------</span>

<span class="sd">This module provides functionality to load, process, and extract text from various document types</span>
<span class="sd">(PDF, DOCX, and TXT) for generating lesson-specific content. It includes support for OCR processing</span>
<span class="sd">of scanned documents and handling of structured educational materials like syllabi and lesson readings.</span>

<span class="sd">Classes</span>
<span class="sd">~~~~~~~</span>

<span class="sd">LessonLoader</span>
<span class="sd">    Main class for handling document loading and processing operations.</span>

<span class="sd">Key Functions</span>
<span class="sd">~~~~~~~</span>

<span class="sd">The LessonLoader class provides these key functionalities:</span>

<span class="sd">- Document Loading:</span>
<span class="sd">    - load_directory: Load all documents from a specified directory</span>
<span class="sd">    - load_lessons: Load lessons from multiple directories with lesson number inference</span>
<span class="sd">    - load_readings: Extract text from individual documents</span>
<span class="sd">    - load_beamer_presentation: Load Beamer presentation content</span>

<span class="sd">- Syllabus Processing:</span>
<span class="sd">    - extract_lesson_objectives: Extract objectives for specific lessons</span>
<span class="sd">    - load_docx_syllabus: Load and parse DOCX syllabus content</span>
<span class="sd">    - find_docx_indices: Locate lesson sections within syllabus</span>

<span class="sd">- Text Extraction:</span>
<span class="sd">    - extract_text_from_pdf: Extract text from PDF files</span>
<span class="sd">    - ocr_pdf: Perform OCR on scanned documents</span>
<span class="sd">    - convert_pdf_to_docx: Convert PDF files to DOCX format</span>

<span class="sd">Dependencies</span>
<span class="sd">~~~~~~~~~~~</span>

<span class="sd">Core Dependencies:</span>
<span class="sd">    - pypdf: PDF text extraction</span>
<span class="sd">    - python-docx: DOCX file handling</span>
<span class="sd">    - pathlib: File path operations</span>
<span class="sd">    - typing: Type hints</span>

<span class="sd">Optional OCR Dependencies:</span>
<span class="sd">    - pytesseract: OCR processing</span>
<span class="sd">    - pdf2image: PDF to image conversion</span>
<span class="sd">    - spacy: Text processing</span>
<span class="sd">    - contextualSpellCheck: Text correction</span>
<span class="sd">    - img2table: Table extraction from images</span>

<span class="sd">Example Usage</span>
<span class="sd">~~~~~~~~~~~~~</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    from class_factory.utils.load_documents import LessonLoader</span>

<span class="sd">    # Initialize loader with paths</span>
<span class="sd">    loader = LessonLoader(</span>
<span class="sd">        syllabus_path=&quot;path/to/syllabus.docx&quot;,</span>
<span class="sd">        reading_dir=&quot;path/to/readings&quot;</span>
<span class="sd">    )</span>

<span class="sd">    # Load specific lesson content</span>
<span class="sd">    lesson_content = loader.load_lessons(lesson_number=5)</span>

<span class="sd">    # Extract lesson objectives</span>
<span class="sd">    objectives = loader.extract_lesson_objectives(current_lesson=5)</span>

<span class="sd">Notes</span>
<span class="sd">~~~~~</span>

<span class="sd">- OCR functionality requires additional package installation via `pip install class_factory[ocr]`</span>
<span class="sd">- Directory structure should follow consistent naming (e.g., &#39;L1&#39;, &#39;L2&#39;, etc.)</span>
<span class="sd">- Supports both PDF and DOCX syllabus formats with automatic conversion if needed</span>

<span class="sd">See Also</span>
<span class="sd">~~~~~~~~</span>

<span class="sd">- :class:`class_factory.utils.tools.logger_setup`: Logger configuration</span>
<span class="sd">- :mod:`class_factory.utils.base_model`: Base model implementation</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># %%</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pypdf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">docx</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
<span class="c1"># doc import</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">docx.opc.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageNotFoundError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">markitdown</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">FileConversionException</span><span class="p">,</span> <span class="n">MarkItDown</span><span class="p">,</span>
                        <span class="n">UnsupportedFormatException</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pdf2docx</span><span class="w"> </span><span class="kn">import</span> <span class="n">Converter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyprojroot.here</span><span class="w"> </span><span class="kn">import</span> <span class="n">here</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">class_factory.utils.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger_setup</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pytesseract</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pdf2image</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_from_path</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">pytesseract</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">Image</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">convert_from_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">spacy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">contextualSpellCheck</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">img2table</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="LessonLoader">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LessonLoader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for loading and managing educational content from various document formats.</span>

<span class="sd">    This class handles loading and processing of lesson materials including syllabi, readings,</span>
<span class="sd">    and Beamer presentations. It supports multiple file formats (PDF, DOCX, TXT) and provides</span>
<span class="sd">    OCR capabilities for scanned documents when necessary.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        reading_dir (Path): Directory containing lesson reading materials</span>
<span class="sd">        slide_dir (Path): Directory containing Beamer presentation slides</span>
<span class="sd">        project_dir (Path): Root project directory</span>
<span class="sd">        syllabus_path (Path): Path to the course syllabus file</span>
<span class="sd">        logger (Logger): Class logger instance</span>

<span class="sd">    Args:</span>
<span class="sd">        syllabus_path (Union[Path, str]): Path to the syllabus file</span>
<span class="sd">        reading_dir (Union[Path, str]): Directory containing lesson readings</span>
<span class="sd">        slide_dir (Union[Path, str], optional): Directory for Beamer slides. Defaults to None.</span>
<span class="sd">        project_dir (Union[Path, str], optional): Root directory for the project. Defaults to None.</span>
<span class="sd">        verbose (bool, optional): Whether to show detailed logging. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syllabus_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">reading_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                 <span class="n">slide_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">project_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tabular_syllabus</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes LessonLoader with paths and performs validation.</span>

<span class="sd">        Args:</span>
<span class="sd">            syllabus_path (Union[Path, str]): Path to the syllabus file.</span>
<span class="sd">            reading_dir (Union[Path, str]): Directory for lesson readings.</span>
<span class="sd">            slide_dir (Union[Path, str]): Directory for Beamer slides, Default is None.</span>
<span class="sd">            project_dir (Union[Path, str]): Root directory for the project, Default is None. If not provided, returns pyprojroot.here.here()</span>
<span class="sd">            log_level (int): Logging level for the LessonLoader instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger_setup</span><span class="p">(</span><span class="n">logger_name</span><span class="o">=</span><span class="s2">&quot;lesson_loader_logger&quot;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">log_level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reading_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dir_path</span><span class="p">(</span><span class="n">reading_dir</span><span class="p">,</span> <span class="s2">&quot;reading directory&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slide_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dir_path</span><span class="p">(</span><span class="n">slide_dir</span><span class="p">,</span> <span class="s2">&quot;slide directory&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">slide_dir</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dir_path</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="s2">&quot;root project directory&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">project_dir</span> <span class="k">else</span> <span class="n">here</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syllabus_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_file_path</span><span class="p">(</span><span class="n">syllabus_path</span><span class="p">,</span> <span class="s2">&quot;syllabus file&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">syllabus_path</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">syllabus_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No syllabus path provided. Generated content may not be as accurate or comprehensive without a syllabus.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tabular_syllabus</span> <span class="o">=</span> <span class="n">tabular_syllabus</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">slide_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slide_dir</span>

    <span class="nd">@slide_dir</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">slide_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update slide_dir and validate if a path is provided.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slide_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dir_path</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;slide directory&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slide directory updated to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_slide_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slide_dir</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Clear if None is passed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_directory_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the directory structure for lesson readings, ensuring that each directory</span>
<span class="sd">        follows the expected pattern and contains supported file types.</span>

<span class="sd">        Expected Directory Naming:</span>
<span class="sd">            Each directory should correspond to a lesson and follow a naming pattern such as:</span>
<span class="sd">            - &quot;L1&quot;, &quot;Lesson_1&quot;, &quot;Lecture 1&quot;, &quot;W1&quot;, &quot;Week_1&quot;, etc.</span>
<span class="sd">            - The pattern allows optional spaces or underscores between the lesson identifier (e.g., &quot;L&quot;, &quot;Lesson&quot;, etc.)</span>
<span class="sd">              and the lesson number.</span>

<span class="sd">        Supported File Types:</span>
<span class="sd">            Each lesson directory should contain at least one reading file of type: .pdf, .txt, or .docx.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the structure does not match the expected layout, listing any issues found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Updated regex pattern to allow for flexible directory names with optional spaces or underscores</span>
        <span class="n">expected_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^(L|Lesson|Lecture|W|Week)[\s_-]*\d+$&#39;</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reading_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">subdir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">expected_pattern</span><span class="p">,</span> <span class="n">subdir</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                    <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">subdir</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not match expected pattern &#39;</span><span class="si">{</span><span class="n">expected_pattern</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                                  <span class="s2">&quot;Recommend consistent naming convention by lesson (e.g., &#39;L1&#39;, &#39;L2&#39;, etc.).&quot;</span><span class="p">)</span>

                <span class="c1"># Check for supported file formats within each lesson directory</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;.docx&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">subdir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">()):</span>
                    <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">subdir</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not contain any supported reading files (.pdf, .txt, .docx).&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">issues</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Directory structure validation failed with the following issues:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">issues</span><span class="p">)</span> <span class="o">+</span>
                                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Continue if desired or this is a known issue in the provided directory.&quot;</span><span class="p">)</span>
            <span class="c1"># raise ValueError(&quot;Directory structure validation failed with the following issues:\n&quot; + &quot;\n&quot;.join(issues))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_file_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates that the given path is an existing file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> at path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist or is not a file.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_dir_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">create_if_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates that the given path is an existing directory. Optionally creates it if missing.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (Union[Path, str]): The directory path to validate.</span>
<span class="sd">            name (str): Directory name for error messages.</span>
<span class="sd">            create_if_missing (bool): If True, creates the directory if it doesn&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">create_if_missing</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NotADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> at path &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; does not exist or is not a directory.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>

<div class="viewcode-block" id="LessonLoader.ocr_available">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.ocr_available">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ocr_available</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate if current packages installed support OCR&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">pytesseract</span><span class="p">,</span> <span class="n">Image</span><span class="p">,</span> <span class="n">convert_from_path</span><span class="p">,</span> <span class="n">spacy</span><span class="p">,</span> <span class="n">contextualSpellCheck</span><span class="p">,</span> <span class="n">img2table</span><span class="p">])</span></div>


<div class="viewcode-block" id="LessonLoader.missing_ocr_packages">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.missing_ocr_packages">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">missing_ocr_packages</span><span class="p">():</span>
        <span class="n">packages</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;pytesseract&quot;</span><span class="p">:</span> <span class="n">pytesseract</span><span class="p">,</span>
            <span class="s2">&quot;pillow&quot;</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
            <span class="s2">&quot;pdf2image&quot;</span><span class="p">:</span> <span class="n">convert_from_path</span><span class="p">,</span>
            <span class="s2">&quot;spacy&quot;</span><span class="p">:</span> <span class="n">spacy</span><span class="p">,</span>
            <span class="s2">&quot;contextualSpellCheck&quot;</span><span class="p">:</span> <span class="n">contextualSpellCheck</span><span class="p">,</span>
            <span class="s2">&quot;img2table&quot;</span><span class="p">:</span> <span class="n">img2table</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pkg_name</span> <span class="k">for</span> <span class="n">pkg_name</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">packages</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span></div>


<div class="viewcode-block" id="LessonLoader.load_readings">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.load_readings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_readings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load text content from a single document file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path (Union[str, Path]): Path to the document file to load</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Extracted text content prefixed with the file title</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If file type is unsupported or file is corrupted</span>
<span class="sd">            ImportError: If OCR packages are needed but not installed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;title: &#39;</span> <span class="o">+</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">:</span>
                <span class="n">extracted_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_text_from_pdf</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.docx&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
                    <span class="n">extracted_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">para</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">])</span>
                <span class="k">except</span> <span class="n">PackageNotFoundError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to open </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. The file might be corrupted.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">extracted_text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">extracted_text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file type: </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">extracted_text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No readable text found in </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. File may be empty or unreadable.&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while reading </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="k">return</span> <span class="n">text</span> <span class="o">+</span> <span class="n">extracted_text</span> <span class="k">if</span> <span class="n">extracted_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;No readable text found.&quot;</span></div>


<div class="viewcode-block" id="LessonLoader.load_directory">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.load_directory">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">load_from_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load all valid document files within a directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            load_from_dir (Union[Path, str]): Directory path to load documents from</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: List of extracted text content from all valid documents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">load_from_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">load_from_dir</span><span class="p">)</span>

        <span class="n">all_documents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">load_from_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;.docx&#39;</span><span class="p">]:</span>
                <span class="n">all_documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_readings</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">all_documents</span></div>


<div class="viewcode-block" id="LessonLoader.load_lessons">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.load_lessons">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_lessons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lesson_number_or_range</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">range</span><span class="p">],</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load specific lessons by scanning directories based on lesson numbers.</span>

<span class="sd">        Args:</span>
<span class="sd">            lesson_number_or_range (Union[int, range]): A single lesson number or range of lesson numbers to load.</span>
<span class="sd">            logger: Optional custom logger.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, List[str]]: A dictionary where each key is a lesson number and each value is a list of readings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">logger_setup</span><span class="p">(</span><span class="n">logger_name</span><span class="o">=</span><span class="s2">&quot;load_lessons_func_logger&quot;</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
        <span class="n">lesson_range</span> <span class="o">=</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lesson_number_or_range</span><span class="p">,</span> <span class="n">lesson_number_or_range</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lesson_number_or_range</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
                        <span class="k">else</span> <span class="n">lesson_number_or_range</span><span class="p">)</span>

        <span class="n">all_readings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># same pattern as validate_directory_structure</span>
        <span class="n">expected_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^(L|Lesson|Lecture|W|Week)[\s_-]*(\d+)$&#39;</span>

        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">subdirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reading_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">subdir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="c1"># load actual files</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">expected_pattern</span><span class="p">,</span> <span class="n">subdir</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">lesson_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">lesson_no</span> <span class="ow">in</span> <span class="n">lesson_range</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading readings for lesson </span><span class="si">{</span><span class="n">lesson_no</span><span class="si">}</span><span class="s2"> from directory: </span><span class="si">{</span><span class="n">subdir</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">all_readings</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">lesson_no</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_directory</span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span>

                        <span class="c1"># load filenames for user</span>
                        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">subdir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;.docx&#39;</span><span class="p">]:</span>
                                <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                                <span class="n">subdirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping directory </span><span class="si">{</span><span class="n">subdir</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as it is not in the specified lesson range.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">subdir</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not match expected lesson naming pattern.&quot;</span><span class="p">)</span>

        <span class="n">pretty_subdirs</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">subdirs</span><span class="p">)))</span> <span class="k">if</span> <span class="n">subdirs</span> <span class="k">else</span> <span class="s2">&quot;(none)&quot;</span>
        <span class="k">if</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="n">pretty</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  - &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  - &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Lesson </span><span class="si">{</span><span class="n">lesson_number_or_range</span><span class="si">}</span><span class="s2">: using the following readings:</span><span class="se">\n</span><span class="si">{</span><span class="n">pretty</span><span class="si">}</span>
<span class="s2">                    </span><span class="se">\n</span><span class="s2">If this is incorrect, please add the correct readings to the respective lesson folder(s): </span><span class="si">{</span><span class="n">pretty_subdirs</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Lesson </span><span class="si">{</span><span class="n">lesson_number_or_range</span><span class="si">}</span><span class="s2">: no readings assigned. If this is unexpected, please add the correct readings to the respective lesson folder(s): </span><span class="si">{</span>
<span class="w">                    </span><span class="n">pretty_subdirs</span><span class="si">}</span><span class="s2">.&quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">all_readings</span></div>


<div class="viewcode-block" id="LessonLoader.load_beamer_presentation">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.load_beamer_presentation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_beamer_presentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tex_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loas a Beamer presentation from a .tex file and returns it as a string.</span>

<span class="sd">        Args:</span>
<span class="sd">            tex_path (Path): The path to the .tex file containing the Beamer presentation.</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: The content of the .tex file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tex_path</span> <span class="o">==</span> <span class="s2">&quot;No prior presentation available.&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex_path</span>

        <span class="n">tex_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tex_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tex_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">beamer_text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">beamer_text</span></div>


<div class="viewcode-block" id="LessonLoader.find_prior_beamer_presentation">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.find_prior_beamer_presentation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_prior_beamer_presentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lesson_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamically finds the most recent prior lesson to use as a template for slide creation.</span>

<span class="sd">        Args:</span>
<span class="sd">            lesson_no (int): The current lesson number.</span>
<span class="sd">            max_attempts (int): The maximum number of previous lessons to attempt loading (default 3).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path | str: The path to the found Beamer file from a prior lesson.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If no valid prior lesson file is found within the `max_attempts` range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_attempts</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">prior_lesson</span> <span class="o">=</span> <span class="n">lesson_no</span> <span class="o">-</span> <span class="n">i</span>
            <span class="n">beamer_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;L</span><span class="si">{</span><span class="n">prior_lesson</span><span class="si">}</span><span class="s1">.tex&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide_dir</span> <span class="k">else</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;L</span><span class="si">{</span><span class="n">prior_lesson</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>

            <span class="c1"># Check if the Beamer file exists for this prior lesson</span>
            <span class="k">if</span> <span class="n">beamer_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found prior lesson: Lesson </span><span class="si">{</span><span class="n">prior_lesson</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">beamer_file</span>

        <span class="c1"># Raise error if no valid prior Beamer file is found within the attempts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No prior Beamer file found within the last </span><span class="si">{</span><span class="n">max_attempts</span><span class="si">}</span><span class="s2"> lessons.</span><span class="se">\n</span><span class="s2">Returning empty.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;No prior presentation available.&quot;</span></div>


<div class="viewcode-block" id="LessonLoader.extract_text_from_pdf">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.extract_text_from_pdf">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_text_from_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract text content from a PDF file, with OCR fallback if needed.</span>

<span class="sd">        Args:</span>
<span class="sd">            pdf_path (Union[str, Path]): Path to the PDF file</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Extracted text content from the PDF</span>

<span class="sd">        Raises:</span>
<span class="sd">            ImportError: If text extraction fails and OCR packages are not available</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text_content</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">pypdf</span><span class="o">.</span><span class="n">PdfReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">pages</span><span class="p">:</span>
                <span class="n">page_text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">extract_text</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">page_text</span><span class="p">:</span>
                    <span class="n">paragraphs</span> <span class="o">=</span> <span class="n">page_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">text_content</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">paragraph</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">paragraphs</span> <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text_content</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr_available</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No readable text found in pdf </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. Attempting OCR.&quot;</span><span class="p">)</span>
            <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr_pdf</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ocr_result</span> <span class="k">if</span> <span class="n">ocr_result</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;OCR did not produce readable text.&quot;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">text_content</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr_available</span><span class="p">():</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_ocr_packages</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No readable text found in PDF </span><span class="si">{</span><span class="n">pdf_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">OCR support requires: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Install with `pip install class_factory[ocr]`, or convert the file to readable text.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_content</span><span class="p">)</span></div>


<div class="viewcode-block" id="LessonLoader.ocr_pdf">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.ocr_pdf">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ocr_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform OCR on a PDF file to extract text content.</span>

<span class="sd">        Args:</span>
<span class="sd">            pdf_path (Path): Path to the PDF file</span>
<span class="sd">            max_workers (int, optional): Number of parallel workers for OCR. Defaults to 4.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Extracted text content from OCR</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pytesseract</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pdf2image</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_from_path</span>

        <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">convert_from_path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">ocr_text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="n">ocr_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_text</span><span class="p">)</span></div>


<div class="viewcode-block" id="LessonLoader.load_docx_syllabus">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.load_docx_syllabus">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_docx_syllabus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syllabus_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">retry_delay</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># seconds</span>
        <span class="n">syllabus_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">syllabus_path</span><span class="p">)</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">MarkItDown</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">raw_content</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">syllabus_path</span><span class="p">))</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">raw_content</span><span class="o">.</span><span class="n">text_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="c1"># Handle table-like rows in lesson objectives</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">):</span>
                        <span class="n">tablines</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tablines</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">lines</span>

            <span class="k">except</span> <span class="p">(</span><span class="n">PackageNotFoundError</span><span class="p">,</span> <span class="n">FileConversionException</span><span class="p">,</span> <span class="n">UnsupportedFormatException</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document `</span><span class="si">{</span><span class="n">syllabus_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` is currently open. Retrying in </span><span class="si">{</span><span class="n">retry_delay</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_delay</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PackageNotFoundError</span><span class="p">(</span><span class="s2">&quot;Unable to open the document after multiple attempts. Please close the file and try again.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="LessonLoader.extract_lesson_objectives">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.extract_lesson_objectives">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_lesson_objectives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_lesson</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">only_current</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract lesson objectives from the syllabus for specified lesson(s).</span>

<span class="sd">        Args:</span>
<span class="sd">            current_lesson (Union[int, str]): The lesson number to extract objectives for</span>
<span class="sd">            only_current (bool, optional): If True, return only current lesson objectives.</span>
<span class="sd">                If False, include previous and next lessons. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Extracted lesson objectives text. Returns &quot;No lesson objectives provided&quot;</span>
<span class="sd">                if no syllabus path is set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">syllabus_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;No lesson objectives provided.&quot;</span>
        <span class="n">syllabus_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syllabus_path</span><span class="p">)</span>
        <span class="c1"># if syllabus_path.suffix == &#39;.pdf&#39;:</span>
        <span class="c1">#     syllabus_path = self.convert_pdf_to_docx(syllabus_path)</span>
        <span class="n">syllabus_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_docx_syllabus</span><span class="p">(</span><span class="n">syllabus_path</span><span class="p">)</span>

        <span class="n">current_lesson</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_lesson</span><span class="p">)</span>
        <span class="n">prev_idx</span><span class="p">,</span> <span class="n">curr_idx</span><span class="p">,</span> <span class="n">next_idx</span><span class="p">,</span> <span class="n">end_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_docx_indices</span><span class="p">(</span>
            <span class="n">syllabus_content</span><span class="p">,</span> <span class="n">current_lesson</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabular_syllabus</span><span class="p">:</span>
            <span class="n">prev_lesson_content</span> <span class="o">=</span> <span class="n">syllabus_content</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">]</span> <span class="k">if</span> <span class="n">prev_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">curr_lesson_content</span> <span class="o">=</span> <span class="n">syllabus_content</span><span class="p">[</span><span class="n">curr_idx</span><span class="p">]</span> <span class="k">if</span> <span class="n">curr_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">next_lesson_content</span> <span class="o">=</span> <span class="n">syllabus_content</span><span class="p">[</span><span class="n">next_idx</span><span class="p">]</span> <span class="k">if</span> <span class="n">next_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">prev_lesson_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">syllabus_content</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">curr_idx</span><span class="p">])</span> <span class="k">if</span> <span class="n">prev_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">curr_lesson_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">syllabus_content</span><span class="p">[</span><span class="n">curr_idx</span><span class="p">:</span><span class="n">next_idx</span><span class="p">])</span> <span class="k">if</span> <span class="n">curr_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">next_lesson_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">syllabus_content</span><span class="p">[</span><span class="n">next_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">])</span> <span class="k">if</span> <span class="n">next_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="n">combined_content</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">prev_lesson_content</span><span class="p">,</span> <span class="n">curr_lesson_content</span><span class="p">,</span> <span class="n">next_lesson_content</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">curr_lesson_content</span> <span class="k">if</span> <span class="n">only_current</span> <span class="k">else</span> <span class="n">combined_content</span></div>


<div class="viewcode-block" id="LessonLoader.find_docx_indices">
<a class="viewcode-back" href="../../../modules.html#class_factory.utils.load_documents.LessonLoader.find_docx_indices">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_docx_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">syllabus</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">current_lesson</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">lesson_identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the indices of the lessons in the syllabus content.</span>

<span class="sd">        Args:</span>
<span class="sd">            syllabus (List[str]): A list of strings where each string represents a line in the syllabus document.</span>
<span class="sd">            current_lesson (int): The lesson number for which to find surrounding lessons.</span>
<span class="sd">            lesson_identifier (str, Defaults to None): The special word indicating a new lesson on the syllabus (eg &quot;Lesson&quot; or &quot;Week&quot;)</span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple[int, int, int, int]: The indices of the previous, current, next, and the end of the next lesson.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prev_lesson</span><span class="p">,</span> <span class="n">curr_lesson</span><span class="p">,</span> <span class="n">next_lesson</span><span class="p">,</span> <span class="n">end_lesson</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabular_syllabus</span><span class="p">:</span>
            <span class="c1"># Search tables if no matches found</span>
            <span class="k">if</span> <span class="n">curr_lesson</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Matches table rows starting with numbers or &quot;|&quot;</span>
                <span class="n">lesson_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\d+)\s*\||^\s*\|\s*(\d+)\s*\|&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syllabus</span><span class="p">):</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">lesson_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                        <span class="n">matches</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                        <span class="c1"># Extract numeric lesson from match groups</span>
                        <span class="n">lesson_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">matches</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">lesson_number</span> <span class="o">==</span> <span class="n">current_lesson</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">prev_lesson</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">elif</span> <span class="n">lesson_number</span> <span class="o">==</span> <span class="n">current_lesson</span><span class="p">:</span>
                            <span class="n">curr_lesson</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">elif</span> <span class="n">lesson_number</span> <span class="o">==</span> <span class="n">current_lesson</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">next_lesson</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">elif</span> <span class="n">lesson_number</span> <span class="o">==</span> <span class="n">current_lesson</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">end_lesson</span> <span class="o">=</span> <span class="n">i</span>
                           <span class="c1"># break</span>
            <span class="k">return</span> <span class="n">prev_lesson</span><span class="p">,</span> <span class="n">curr_lesson</span><span class="p">,</span> <span class="n">next_lesson</span><span class="p">,</span> <span class="n">end_lesson</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lesson_identifier</span><span class="p">:</span>
                <span class="n">lesson_identifiers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lesson&#39;</span><span class="p">,</span> <span class="s1">&#39;Week&#39;</span><span class="p">,</span> <span class="s2">&quot;**Lesson&quot;</span><span class="p">,</span> <span class="s2">&quot;**Week&quot;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">lesson_identifier</span> <span class="ow">in</span> <span class="n">lesson_identifiers</span><span class="p">:</span>
                    <span class="n">escaped_identifier</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">lesson_identifier</span><span class="p">)</span>
                    <span class="n">lesson_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                        <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">escaped_identifier</span><span class="si">}</span><span class="s2">\s*</span><span class="si">{</span><span class="n">current_lesson</span><span class="si">}</span><span class="s2">.*?:&quot;</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syllabus</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">escaped_identifier</span><span class="si">}</span><span class="s2">\s*</span><span class="si">{</span><span class="n">current_lesson</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.*?:?&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                            <span class="n">prev_lesson</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">elif</span> <span class="n">lesson_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                            <span class="n">curr_lesson</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">escaped_identifier</span><span class="si">}</span><span class="s2">\s*</span><span class="si">{</span><span class="n">current_lesson</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.*?:?&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                            <span class="n">next_lesson</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">escaped_identifier</span><span class="si">}</span><span class="s2">\s*</span><span class="si">{</span><span class="n">current_lesson</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">.*?:?&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                            <span class="n">end_lesson</span> <span class="o">=</span> <span class="n">i</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">curr_lesson</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">escaped_identifier</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">lesson_identifier</span><span class="p">)</span>
                <span class="n">lesson_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                    <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">escaped_identifier</span><span class="si">}</span><span class="s2">\s*</span><span class="si">{</span><span class="n">current_lesson</span><span class="si">}</span><span class="s2">.*?:&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syllabus</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">escaped_identifier</span><span class="si">}</span><span class="s2">\s*</span><span class="si">{</span><span class="n">current_lesson</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.*?:?&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="n">prev_lesson</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">elif</span> <span class="n">lesson_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                        <span class="n">curr_lesson</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">escaped_identifier</span><span class="si">}</span><span class="s2">\s*</span><span class="si">{</span><span class="n">current_lesson</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.*?:?&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="n">next_lesson</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">escaped_identifier</span><span class="si">}</span><span class="s2">\s*</span><span class="si">{</span><span class="n">current_lesson</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">.*?:?&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="n">end_lesson</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="n">curr_lesson</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Lesson </span><span class="si">{</span><span class="n">current_lesson</span><span class="si">}</span><span class="s2"> not found in syllabus. Is this a tabular syllabus? Consider setting `tabular_syllabus=True`.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">prev_lesson</span><span class="p">,</span> <span class="n">curr_lesson</span><span class="p">,</span> <span class="n">next_lesson</span><span class="p">,</span> <span class="n">end_lesson</span></div>
</div>


<span class="c1"># %%</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
    <span class="n">user_home</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
    <span class="n">load_dotenv</span><span class="p">()</span>
    <span class="n">pdf_syllabus_path</span> <span class="o">=</span> <span class="n">user_home</span> <span class="o">/</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;pdf_syllabus_path&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;class_config.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="n">class_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PS460&#39;</span><span class="p">]</span>

    <span class="n">slide_dir</span> <span class="o">=</span> <span class="n">user_home</span> <span class="o">/</span> <span class="n">class_config</span><span class="p">[</span><span class="s1">&#39;slideDir&#39;</span><span class="p">]</span>
    <span class="n">syllabus_path</span> <span class="o">=</span> <span class="n">user_home</span> <span class="o">/</span> <span class="n">class_config</span><span class="p">[</span><span class="s1">&#39;syllabus_path&#39;</span><span class="p">]</span>
    <span class="n">readingsDir</span> <span class="o">=</span> <span class="n">user_home</span> <span class="o">/</span> <span class="n">class_config</span><span class="p">[</span><span class="s1">&#39;reading_dir&#39;</span><span class="p">]</span>
    <span class="n">is_tabular_syllabus</span> <span class="o">=</span> <span class="n">class_config</span><span class="p">[</span><span class="s1">&#39;is_tabular_syllabus&#39;</span><span class="p">]</span>

    <span class="n">nontab_syllabus</span> <span class="o">=</span> <span class="n">user_home</span> <span class="o">/</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PS211&#39;</span><span class="p">][</span><span class="s1">&#39;syllabus_path&#39;</span><span class="p">]</span>

    <span class="n">lsn</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="n">loader</span> <span class="o">=</span> <span class="n">LessonLoader</span><span class="p">(</span><span class="n">syllabus_path</span><span class="o">=</span><span class="n">syllabus_path</span><span class="p">,</span>
                          <span class="n">reading_dir</span><span class="o">=</span><span class="n">readingsDir</span><span class="p">,</span>
                          <span class="n">slide_dir</span><span class="o">=</span><span class="n">slide_dir</span><span class="p">,</span>
                          <span class="n">tabular_syllabus</span><span class="o">=</span><span class="n">is_tabular_syllabus</span><span class="p">)</span>

    <span class="n">objs</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">extract_lesson_objectives</span><span class="p">(</span>
        <span class="n">current_lesson</span><span class="o">=</span><span class="n">lsn</span><span class="p">)</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_lessons</span><span class="p">(</span><span class="n">lesson_number_or_range</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

    <span class="n">ocrDir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;C:/Users/Sean/OneDrive - afacademy.af.edu/Documents/Classes/Fall 2024/PS211/02_Class Readings/L21/reference&quot;</span><span class="p">)</span>
    <span class="n">pdf_path</span> <span class="o">=</span> <span class="n">ocrDir</span> <span class="o">/</span> <span class="s2">&quot;21.3 Pew Research Center. Beyond Red vs Blue Overview.pdf&quot;</span>
    <span class="n">ocr_result</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">ocr_pdf</span><span class="p">(</span><span class="n">pdf_path</span><span class="p">)</span>

<span class="c1"># %%</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">ClassFactory 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">class_factory.utils.load_documents</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2025, Sean Peters.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    </div>
  </body>
</html>